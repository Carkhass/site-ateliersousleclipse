---
import ScriptsFooter from '../components/ScriptsFooter.astro';
---

<html lang="fr" class="transition-colors duration-300 no-js">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>L'Atelier sous l‚Äô√©clipse</title>

    <!-- Styles globaux: retir√© le <link> cass√©; index.astro importe d√©j√† global.css -->
    <!-- Si tu veux le global via layout, je te le pr√©pare proprement ensuite -->

    <!-- CSS Swiper -->
<link rel="stylesheet" href="/styles/swiper-bundle.min.css" />
<!-- CSS GLightbox -->
<link rel="stylesheet" href="/styles/glightbox.min.css" />

  </head>

  <body class="flex flex-col min-h-screen font-sans bg-bg text-text">
    <!-- Ne plus retirer no-js ici: le script reveal s‚Äôen charge au bon moment -->
    <!-- <script>document.documentElement.classList.remove('no-js');</script> -->

<!-- ================= HEADER GLOBAL ================= -->
<header 
  class="bg-bg/20 backdrop-blur-sm text-text shadow-md sticky top-0 z-50 transition-colors duration-300"
>
  <div class="container mx-auto px-4 flex justify-between items-center h-20">
    
    <!-- Logo + Nom -->
    <div class="flex items-center space-x-4">
      <img 
        src="/images/logo-eclipse.png" 
        alt="Logo Atelier sous l‚Äô√©clipse" 
        class="h-12 w-12 drop-shadow-[0_0_10px_var(--color-accent)]"
        loading="eager" decoding="async"
      />
      <span class="text-xl font-bold tracking-wide">
        L'Atelier sous l‚Äô√©clipse
      </span>
    </div>

    <!-- Menu desktop -->
    <nav class="hidden md:flex space-x-6 font-semibold" aria-label="Navigation principale">
      <a href="/" class="hover:text-accent transition-colors" aria-current={Astro.url.pathname === '/' ? 'page' : undefined}>Accueil</a>
      <a href="/galerie" class="hover:text-accent transition-colors" aria-current={Astro.url.pathname.startsWith('/galerie') ? 'page' : undefined}>Galerie</a>
      <a href="/boutique" class="hover:text-accent transition-colors" aria-current={Astro.url.pathname.startsWith('/boutique') ? 'page' : undefined}>Boutique</a>
      <a href="/me-connaitre" class="hover:text-accent transition-colors" aria-current={Astro.url.pathname.startsWith('/me-connaitre') ? 'page' : undefined}>Me conna√Ætre</a>
      <a href="/contact" class="hover:text-accent transition-colors" aria-current={Astro.url.pathname.startsWith('/contact') ? 'page' : undefined}>Contact</a>
    </nav>

    <!-- Boutons √† droite -->
    <div class="flex items-center space-x-4">
      <button 
        id="theme-toggle" 
        class="p-2 rounded bg-surface text-text hover:text-accent transition-colors"
        aria-label="Changer le th√®me"
      >üåô</button>
      <button 
        id="menu-toggle" 
        class="md:hidden p-2 rounded bg-surface text-text hover:text-accent transition-colors"
        aria-label="Ouvrir le menu"
      >‚ò∞</button>
    </div>
  </div>
</header>
<!-- ================= FIN HEADER ================= -->

<!-- Menu mobile -->
<div class="menu-overlay"></div>
<nav class="menu flex flex-col space-y-4 p-6 bg-surface fixed top-0 right-0 h-full w-64 transform translate-x-full transition-transform duration-300 z-[100]" aria-label="Menu mobile">
  <a href="/" class="hover:text-accent">Accueil</a>
  <a href="/galerie" class="hover:text-accent">Galerie</a>
  <a href="/boutique" class="hover:text-accent">Boutique</a>
  <a href="/me-connaitre" class="hover:text-accent">Me conna√Ætre</a>
  <a href="/contact" class="hover:text-accent">Contact</a>
</nav>


    <!-- ================= CONTENU DES PAGES ================= -->
    <main class="flex-1">
      <slot />
    </main>

<!-- ================= FOOTER ================= -->
<footer class="bg-surface text-muted text-center p-6 mt-auto relative overflow-visible">
  <p>&copy; {new Date().getFullYear()} Atelier sous l‚Äô√©clipse ‚Äî Tous droits r√©serv√©s.</p>
  
  <div class="flex justify-center space-x-6 mt-4">
    
    <!-- Instagram -->
    <div class="relative group overflow-visible">
      <a href="https://www.instagram.com/ateliersousleclipse?igsh=MXI3bTMwMnc0bTZ6Zw==" 
         aria-label="Instagram"
         class="hover:text-accent hover:scale-110 transition-transform" target="_blank" rel="noopener">
        <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" 
             viewBox="0 0 24 24" class="w-6 h-6">
          <path d="M7.5 2h9A5.5 5.5 0 0 1 22 7.5v9A5.5 5.5 0 0 1 16.5 22h-9A5.5 5.5 0 0 1 2 16.5v-9A5.5 5.5 0 0 1 7.5 2zm0 2A3.5 3.5 0 0 0 4 7.5v9A3.5 3.5 0 0 0 7.5 20h9a3.5 3.5 0 0 0 3.5-3.5v-9A3.5 3.5 0 0 0 16.5 4h-9zM12 7a5 5 0 1 1 0 10 5 5 0 0 1 0-10zm0 2a3 3 0 1 0 0 6 3 3 0 0 0 0-6zm5.75-2.25a1.25 1.25 0 1 1-2.5 0 1.25 1.25 0 0 1 2.5 0z"/>
        </svg>
      </a>
      <img src="/images/qr-code-INSTA-2.0.png" alt="QR code Instagram" 
           class="qr absolute top-[-170px] left-1/2 -translate-x-1/2 opacity-0 scale-95 
                  group-hover:opacity-100 group-hover:scale-100 transition-transform duration-300 bg-white p-1 z-[9999] pointer-events-none" />
    </div>

    <!-- Facebook -->
    <div class="relative group overflow-visible">
      <a href="https://www.facebook.com/AtelierSousEclipse/" 
         aria-label="Facebook"
         class="hover:text-accent hover:scale-110 transition-transform" target="_blank" rel="noopener">
        <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor"
             viewBox="0 0 24 24" class="w-6 h-6">
          <path d="M22 12a10 10 0 1 0-11.5 9.9v-7h-2v-2.9h2v-2.2c0-2 1.2-3.1 3-3.1.9 0 1.8.1 1.8.1v2h-1c-1 0-1.3.6-1.3 1.2v2h2.3L15 14.9h-2v7A10 10 0 0 0 22 12"/>
        </svg>
      </a>
      <img src="/images/qr-code-FB-2.0.png" alt="QR code Facebook" 
           class="qr absolute top-[-170px] left-1/2 -translate-x-1/2 opacity-0 scale-95 
                  group-hover:opacity-100 group-hover:scale-100 transition-transform duration-300 bg-white p-1 z-[9999] pointer-events-none" />
    </div>
  </div>
</footer>




    <!-- Scripts -->
    <script>
      const html = document.documentElement;
      const savedTheme = localStorage.getItem('theme');
      if (savedTheme) {
        html.classList.toggle('dark', savedTheme === 'dark');
      }
      const btnTheme = document.getElementById('theme-toggle');
      if (btnTheme) {
        btnTheme.addEventListener('click', () => {
          const isDark = html.classList.toggle('dark');
          localStorage.setItem('theme', isDark ? 'dark' : 'light');
          btnTheme.textContent = isDark ? '‚òÄÔ∏è' : 'üåô';
        });
      }
    </script>

    <script>
      const menuToggle = document.getElementById('menu-toggle');
      const menu = document.querySelector('.menu');
      const overlay = document.querySelector('.menu-overlay');
      function openMenu() {
        menu.classList.remove('closing');
        menu.classList.add('open');
        overlay.classList.add('active');
      }
      function closeMenu() {
        menu.classList.remove('open');
        menu.classList.add('closing');
        overlay.classList.remove('active');
      }
      if (menuToggle && menu && overlay) {
        menuToggle.addEventListener('click', openMenu);
        overlay.addEventListener('click', closeMenu);
      }
    </script>

<!-- Script Parallaxe -->
<script>
(() => {
  const visible = new Set();
  let ticking = false;
  const sections = Array.from(document.querySelectorAll('.parallax-section'));

  const io = new IntersectionObserver((entries) => {
    entries.forEach(e => {
      if (e.isIntersecting) visible.add(e.target);
      else visible.delete(e.target);
    });
    requestTick();
  }, { root: null, rootMargin: '20% 0px', threshold: 0 });

  sections.forEach(sec => io.observe(sec));

  function requestTick() {
    if (!ticking) {
      ticking = true;
      requestAnimationFrame(update);
    }
  }

  function update() {
    ticking = false;
    const vh = window.innerHeight;

    visible.forEach(section => {
      const target = section.querySelector('[data-parallax-target]');
      if (!target) return;

      const rect = section.getBoundingClientRect();
      const progress = ((rect.top + rect.height / 2) - vh / 2) / (vh / 2);

      const speed = parseFloat(section.getAttribute('data-parallax-speed')) || 45;

      // OFFSET en % ou px
      let offset = 0;
      const rawOffset = section.getAttribute('data-parallax-offset');
      if (rawOffset) {
        if (rawOffset.trim().endsWith('%')) {
          offset = (parseFloat(rawOffset) / 100) * rect.height;
        } else {
          offset = parseFloat(rawOffset) || 0;
        }
      }

      // Calcul du translate
      const translate = -progress * (speed / 2) + offset;

      // Zoom progressif
      const baseZoom = parseFloat(section.getAttribute('data-parallax-zoom')) || 1.28;
      const zoomStrength = parseFloat(section.getAttribute('data-parallax-zoom-strength')) || 0.08;
      const zoom = baseZoom + Math.abs(progress) * zoomStrength;


      target.style.transform = `translateY(${translate}px) scale(${zoom})`;
    });
  }

  window.addEventListener('scroll', requestTick, { passive: true });
  window.addEventListener('resize', requestTick);
  document.addEventListener('DOMContentLoaded', requestTick);

  const mo = new MutationObserver(() => {
    document.querySelectorAll('.parallax-section').forEach(sec => io.observe(sec));
    requestTick();
  });
  mo.observe(document.body, { childList: true, subtree: true });
})();
</script>

<script>
  window.addEventListener('scroll', () => {
    document.querySelector('header')
      ?.classList.toggle('scrolled', window.scrollY > 50);
  });
</script>
  <!-- Inclusion brute des scripts -->
  <ScriptsFooter />

</body>
</html>

